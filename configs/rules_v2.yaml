version: 2
dsl_mode: warn
rule_titles:
  C-RED-001: 非合意の性的描写
  A-RED-001: 未成年×性的（厳重警告）
  A-YEL-001: 要確認：幼い体型＋性的文脈
  A-RED-EXPL-001: 子供 × Explicit
  A-ORG-QUES-001: 子供 × Questionable
  A-RED-SIT-H-QPLUS-001: 子供同士 × Questionable以上
  A-RED-EXPL-SIT-O-001: 年齢差 × Explicit
  A-ORG-QUES-SIT-O-001: 年齢差 × Questionable
  A-ORG-EXPL-SUS-001: 子供（低確度）× Explicit
  A-YEL-QUES-SUS-001: 子供（低確度）× Questionable
  B-RED-NSFW-EXPL-001: 非NSFWチャンネル× Explicit
  B-ORG-NSFW-QUES-STRICT-001: 非NSFWチャンネル× Questionable+
  C-ORG-QUES-STRICT-001: 非合意 × Questionable以上
  E-RED-QPLUS-BEST-001: 獣姦 × Questionable以上
  E-ORG-QPLUS-SUS-001: 獣姦疑い × Questionable以上
  E-YEL-QPLUS-PRES-001: 動物存在 × Questionable以上
  D-RED-SEX-GORE-STRICT-001: 性的 × 重ゴア
  D-ORG-GORE-STRICT-001: 重ゴア単体
thresholds:
  wd14_questionable: 0.35
  wd14_explicit: 0.2
  qe:
    share_min: 0.55
  coercion:
    main_strict: 0.5
    pain_cnt: 1
    sub_min: 1
    uncon_min: 0.35
    force_org: 0.98
  minor:
    sit_enabled: 0.0
groups:
  nsfw_general:
  - nipples
  - nipple_slip
  - nipple_tweak
  - areola_slip
  - pussy
  - pussy_peek
  - clitoris
  - penis
  - penis_peek
  - testicles
  - anus
  - anus_peek
  - nude
  - completely_nude
  - rape
  - molestation
  - sleep_molestation
  - chikan
  - humiliation
  - rough_sex
  - ryona
  - bondage
  - restrained
  - asphyxiation
  - public_use
  - spanked
  - torture
  - abuse
  - bullying
  - groping
  - strangling
  - loli
  - shota
  - small_nipples
  - small_penis
  - cleft_of_venus
  - bestiality
  - animal_penis
  - dog_penis
  - horse_penis
  - knotted_penis
  - pokephilia
  - '69'
  - anal
  - anilingus
  - ass
  - ball_gag
  - bondage
  - bottomless
  - boy_on_top
  - breast_sucking
  - bukkake
  - buttjob
  - cameltoe
  - clothed_masturbation
  - collar
  - cowgirl_position
  - cuffs
  - cum
  - cumdrip
  - cunnilingus
  - deepthroat
  - dildo
  - doggystyle
  - double_handjob
  - double_penetration
  - ejaculation
  - facial
  - fellatio
  - femdom
  - fingering
  - footjob
  - frottage
  - futanari
  - gag
  - gangbang
  - girl_on_top
  - gokkun
  - group_sex
  - guided_penetration
  - hairjob
  - handcuffs
  - handjob
  - inflation
  - irrumatio
  - large_insertion
  - leash
  - masturbation
  - mating_press
  - missionary
  - mutual_masturbation
  - no_bra
  - no_panties
  - object_insertion
  - oral
  - orgy
  - paizuri
  - prone_bone
  - pubic_hair
  - pussy_juice
  - reach-around
  - reverse_cowgirl_position
  - reverse_suspended_congress
  - reverse_upright_straddle
  - sex
  - sex_from_behind
  - sex_toy
  - shackles
  - shibari
  - sitting_on_face
  - spitroast
  - stomach_bulge
  - strangling
  - suspended_congress
  - tally
  - tentacle_sex
  - testicle_sucking
  - thigh_sex
  - threesome
  - topless
  - upright_straddle
  - urethral_insertion
  - vaginal
  explicit_nudity:
  - nipples
  - nipple_slip
  - nipple_tweak
  - areola_slip
  - pussy
  - pussy_peek
  - clitoris
  - penis
  - penis_peek
  - testicles
  - anus
  - anus_peek
  - nude
  - completely_nude
  sexual_act_lexicon:
  - after_anal
  - after_fellatio
  - after_masturbation
  - after_paizuri
  - after_sex
  - after_vaginal
  - afterglow
  - ahegao
  - anal
  - anal_beads
  - anal_fingering
  - anal_object_insertion
  - anal_tail
  - anilingus
  - armpit_sex
  - artificial_vagina
  - assertive_female
  - ball_gag
  - bdsm
  - big_belly
  - bit_gag
  - blindfold
  - bondage
  - bondage_outfit
  - bound_arms
  - bound_legs
  - bound_wrists
  - boy_on_top
  - breast_bondage
  - breast_expansion
  - breast_smother
  - breast_sucking
  - breastfeeding
  - bukkake
  - bust_cup
  - butt_plug
  - buttjob
  - caressing_testicles
  - caught
  - cleave_gag
  - clothed_female_nude_male
  - clothed_female_nude_female
  - clothed_male_nude_female
  - clothed_male_nude_male
  - clothed_masturbation
  - clothed_sex
  - condom
  - cooperative_fellatio
  - cooperative_paizuri
  - cowgirl_position
  - cross-section
  - crotch_grab
  - crotch_rope
  - crotch_rub
  - cum
  - cum_in_ass
  - cum_in_clothes
  - cum_in_mouth
  - cum_in_pussy
  - cum_inflation
  - cum_on_ass
  - cum_on_body
  - cum_on_breasts
  - cum_on_clothes
  - cum_on_eyewear
  - cum_on_feet
  - cum_on_hair
  - cum_on_pectorals
  - cum_on_pussy
  - cum_on_stomach
  - cum_on_tongue
  - cum_pool
  - cumdrip
  - cunnilingus
  - deep_penetration
  - deepthroat
  - diaper
  - dildo
  - dildo_riding
  - doggystyle
  - double_dildo
  - double_handjob
  - double_penetration
  - egg_vibrator
  - ejaculating_while_penetrated
  - ejaculation
  - exhibitionism
  - facial
  - fellatio
  - female_ejaculation
  - female_masturbation
  - femdom
  - fff_threesome
  - ffm_threesome
  - fingering
  - fingering_through_clothes
  - fingering_through_panties
  - foot_worship
  - footjob
  - frogtie
  - frottage
  - fucked_silly
  - full-package_futanari
  - full_nelson
  - futa_on_male
  - futa_with_female
  - futa_with_futa
  - futa_with_male
  - futanari
  - futanari_masturbation
  - futasub
  - gag
  - gag_harness
  - gangbang
  - girl_on_top
  - glory_wall
  - gokkun
  - grinding
  - group_sex
  - guided_breast_grab
  - guided_penetration
  - hairjob
  - handjob
  - happy_sex
  - have_to_pee
  - hitachi_magic_wand
  - hogtie
  - huge_dildo
  - imminent_anal
  - imminent_penetration
  - imminent_vaginal
  - implied_fellatio
  - implied_fingering
  - implied_futanari
  - implied_masturbation
  - implied_sex
  - impregnation
  - inflation
  - internal_cumshot
  - irrumatio
  - lactation
  - lactation_through_clothes
  - large_insertion
  - licking_foot
  - lotion
  - lotion_bottle
  - male_masturbation
  - masturbation
  - mating_press
  - milking_machine
  - missionary
  - mmf_threesome
  - mmm_threesome
  - mutual_masturbation
  - naughty_face
  - newhalf
  - nipple_chain
  - nipple_clamps
  - nipple_pull
  - nipple_tweak
  - no_testicles
  - nursing_handjob
  - object_insertion
  - oral
  - orgy
  - paizuri
  - paizuri_under_clothes
  - peeing
  - peeing_self
  - penises_touching
  - perpendicular_paizuri
  - pet_play
  - pregnant
  - prone_bone
  - prostitution
  - public_indecency
  - public_nudity
  - pussy_juice
  - reach-around
  - remote_control_vibrator
  - reverse_cowgirl_position
  - reverse_suspended_congress
  - reverse_upright_straddle
  - riding_crop
  - ring_gag
  - sex
  - sex_from_behind
  - sex_machine
  - sex_toy
  - shibari
  - shibari_over_clothes
  - sitting_on_face
  - spanked
  - spitroast
  - spooning
  - spreader_bar
  - stomach_bulge
  - straddling_paizuri
  - strap-on
  - suspended_congress
  - suspension
  - table_humping
  - take_your_pick
  - tape_gag
  - teamwork
  - testicle_sucking
  - thigh_sex
  - threesome
  - torogao
  - tribadism
  - triple_penetration
  - two-handed_handjob
  - upright_straddle
  - urethral_insertion
  - used_condom
  - used_condom_on_penis
  - vaginal
  - vaginal_object_insertion
  - vibrator
  - vibrator_in_thighhighs
  - vibrator_on_nipple
  - vibrator_under_clothes
  - vibrator_under_panties
  - voyeurism
  - wakamezake
  - x-ray
  sexual_context_boosters:
  - adjusting_clothes
  - babydoll
  - backless_outfit
  - bikini_pull
  - bodystocking
  - camisole
  - cleavage
  - cleavage_cutout
  - clothes_down
  - clothes_grab
  - clothing_aside
  - corset
  - covering_breasts
  - covering_crotch
  - dress_lift
  - dress_pull
  - fishnets
  - garter_belt
  - garter_straps
  - g-string
  - lace
  - latex
  - lingerie
  - panty_pull
  - see-through
  - strap_slip
  - thighhighs
  - thong
  - underboob
  - undressing
  - unzipped
  - wet_clothes
  - wet_shirt
  coercion_main:
  - rape
  - molestation
  - sleep_molestation
  - chikan
  - humiliation
  - rough_sex
  - ryona
  coercion_sub:
  - bondage
  - restrained
  - asphyxiation
  - public_use
  - spanked
  - torture
  - abuse
  - bullying
  - groping
  - strangling
  unconscious_states:
  - unconscious
  - drugged
  - drunk
  - sleeping
  - hypnosis
  - mind_control
  pain_expressions:
  - pain
  - struggling
  - crying
  - scared
  - trembling
  - embarrassed
  - wince
  - angry
  restraint_gear:
  - collar
  - chain
  - rope
  - cuffs
  - leash
  - blindfold
  - gag
  - shackles
  - handcuffs
  - ball_gag
  - whip
  - crotch_rope
  - riding_crop
  - bit_gag
  - tape_gag
  - bondage_outfit
  - spreader_bar
  - nipple_clamps
  - ring_gag
  - cleave_gag
  - nipple_chain
  - gag_harness
  - hogtie
  minor_peak:
  - loli
  - shota
  - child
  - baby
  minor_body_high:
  - petite
  - aged_down
  minor_body_medium:
  - flat_chest
  - small_breasts
  - flat_ass
  - slim_legs
  - small_nipples
  - small_penis
  - cleft_of_venus
  minor_body_special:
  - oppai_loli
  - shortstack
  minor_situation_high:
  - child_on_child
  minor_situation_other:
  - onee-shota
  - onii-shota
  - onee-loli
  minor_situation_medium:
  - incest
  - age_difference
  - size_difference
  - penis_size_difference
  minor_uniforms:
  - school_uniform
  - serafuku
  - gakuran
  - uwabaki
  - kindergarten_uniform
  - gym_uniform
  - school_swimsuit
  - randoseru
  - school_bag
  minor_school_context:
  - classroom
  - school_desk
  - school_chair
  - gym_storeroom
  gore_peak:
  - guro
  - decapitation
  - severed_head
  - severed_limb
  - amputee
  - double_amputee
  - self-harm
  - suicide
  - corpse
  - death
  blood_tags:
  - blood
  - bleeding
  - blood_on_face
  - blood_on_clothes
  - blood_on_hands
  - blood_on_weapon
  - blood_on_ground
  - blood_in_hair
  - blood_on_bandages
  - blood_on_arm
  - blood_on_leg
  - blood_stain
  - nosebleed
  - pool_of_blood
  - ambiguous_red_liquid
  injury_tags:
  - bruise
  - cuts
  - scratches
  - stitches
  - scar
  - bruise_on_face
  - injury
  death_markers:
  - empty_eyes
  - crying_with_eyes_open
  - no_pupils
  animal_subjects:
  - animal
  - bird
  - cat
  - dog
  - rabbit
  - snake
  - frog
  - horse
  - mouse
  - wolf
  - fox
  - bear
  - tiger
  - sheep
  - panda
  - pig
  - hamster
  - whale
  - turtle
  - squirrel
  - lion
  - monkey
  - dolphin
  - deer
  - cow
  - hedgehog
  - boar
  - elephant
  - puppy
  - ferret
  - goat
  - lizard
  - orca
  - bat_(animal)
  - seal_(animal)
  bestiality_direct:
  - bestiality
  - animal_penis
  - dog_penis
  - horse_penis
  - knotted_penis
  - pokephilia
features:
  nsfw_rating_max: max(rating.sensitive, rating.questionable, rating.explicit)
  explicit_score: max('explicit_nudity')
  sexual_intensity: topk_sum('sexual_act_lexicon', k=3, gt=0.35) + 0.5 * topk_sum('sexual_context_boosters',
    k=3, gt=0.35)
  coercion_score: clamp(max('coercion_main') / 0.2, 0, 1) + clamp(count('coercion_sub',
    gt=0.35), 0, 2) * 0.5 + clamp(max('unconscious_states') / 0.2, 0, 1) * 0.5 + clamp(count('pain_expressions',
    gt=0.2) / 2, 0, 1) * 0.5 + clamp(topk_sum('restraint_gear', k=3, gt=0.2) / 0.6,
    0, 1) * 0.5
  rating_is_explicit: rating.explicit >= const_WD14_EXPL
  rating_is_questionable: rating.questionable >= const_WD14_QUES
  rating_is_qplus: rating_is_explicit || rating_is_questionable
  is_qplus: (rating.explicit >= const_WD14_EXPL) || (rating.questionable >= const_WD14_QUES)
  qe_margin: max(rating.questionable - const_WD14_QUES, rating.explicit - const_WD14_EXPL)
  is_low_margin: qe_margin < const_LOW_MARGIN
  rating_total: clamp(rating.general + rating.sensitive + rating.questionable + rating.explicit,
    0.01, 99.0)
  explicit_share: rating.explicit / rating_total
  questionable_share: rating.questionable / rating_total
  qe_share_max: max(explicit_share, questionable_share)
  qe_share_low: qe_share_max < const_QE_SHARE_MIN
  bestiality_peak: max('bestiality_direct')
  coercion_main_peak: max('coercion_main')
  coercion_gate_main: coercion_main_peak >= const_COERCION_MAIN_STRICT
  uncon_peak: max('unconscious_states')
  pain_peak: max('pain_expressions')
  pain_cnt: count('pain_expressions', gt=0.35)
  sec_peak: max(uncon_peak, pain_peak)
  base_strength: clamp((coercion_main_peak / const_COERCION_PAIR) * (sec_peak / const_COERCION_PAIR),
    0, 1)
  sub_cnt: count('coercion_sub', gt=0.50)
  rest_topk: topk_sum('restraint_gear', k=3, gt=0.50)
  offset_strength: clamp((sub_cnt * 0.12) + ((rest_topk / 1.50) * 0.18), 0, 0.30)
  coercion_final_score: clamp(base_strength + offset_strength, 0, 1)
  coercion_gate_support: (pain_cnt >= const_COERCION_PAIN_CNT) || (sub_cnt >= const_COERCION_SUB_MIN) || (uncon_peak >= const_COERCION_UNCON_MIN)
  coercion_org_threshold: const_COERCION_ORG + (0.03 * is_low_margin)
  is_e: rating.explicit >= const_WD14_EXPL
  is_q: rating.questionable >= const_WD14_QUES
  sexual_main: topk_sum('sexual_act_lexicon', k=3, gt=0.50)
  exposure_prominent: exposure_area >= const_EXPOSURE_HIGH
  is_explicit_exposed: nude.has('FEMALE_GENITALIA_EXPOSED') || nude.has('MALE_GENITALIA_EXPOSED') || nude.has('ANUS_EXPOSED') || nude.has('FEMALE_BREAST_EXPOSED')
  minor_peak_conf: max('minor_peak')
  minor_main_peak: max('minor_peak')
  minor_sit_high_peak: max('minor_situation_high')
  minor_sit_other_peak: max('minor_situation_other')
  minor_suspect_seed: max('minor_body_high')
  minor_mbm_topk: topk_sum('minor_body_medium', k=3, gt=0.35)
  minor_uniform_ctx: count('minor_uniforms', gt=0.35) + count('minor_school_context',
    gt=0.35)
  minor_suspect_base: clamp((minor_suspect_seed / 0.35) * (minor_mbm_topk / 1.05), 0,
    1)
  minor_pos_offset: clamp(minor_uniform_ctx * 0.15, 0, 0.30)
  minor_neg_offset: clamp((max('minor_body_special') / 0.35) * 0.30, 0, 0.30)
  minor_suspect_score: clamp(minor_suspect_base + minor_pos_offset - minor_neg_offset,
    0, 1)
  minor_sit_enabled: const_MINOR_SIT_ENABLED >= 0.5
  gore_main_peak: max('gore_peak')
  injury_topk: topk_sum('injury_tags', k=3, gt=0.35)
  blood_topk: topk_sum('blood_tags', k=3, gt=0.35)
  gore_density_cnt: count('injury_tags', gt=0.35) + count('blood_tags', gt=0.35)
  gore_heavy_gate: (gore_main_peak >= const_GORE_MAIN) && (gore_density_cnt >= const_GORE_DENSITY) && ((injury_topk >= const_GORE_TOPK) || (blood_topk >= const_GORE_TOPK))
  t_main: clamp(gore_main_peak / const_GORE_MAIN, 0, 1)
  t_dense: clamp(gore_density_cnt / const_GORE_DENSITY, 0, 1)
  t_int: max(clamp(injury_topk / const_GORE_TOPK, 0, 1), clamp(blood_topk / const_GORE_TOPK,
    0, 1))
  gore_base_score: clamp(t_main * t_dense * t_int, 0, 1) * 0.60
  death_cnt: count('death_markers', gt=0.35)
  gore_offset: clamp(death_cnt * 0.20 + pain_cnt * 0.10, 0, 0.40)
  gore_final_score: clamp(gore_base_score + gore_offset, 0, 1)
  gore_org_threshold: const_GORE_ORG + (0.03 * is_low_margin)
  gore_red_threshold: const_GORE_RED + (0.03 * is_low_margin)
  animal_presence: max('animal_subjects')
  animal_score: sum('animal_subjects')
rules:
- id: C-ORG-QUES-STRICT-001
  severity: orange
  priority: 85
  when: is_qplus && !qe_share_low && coercion_gate_main && coercion_gate_support && (coercion_final_score >= coercion_org_threshold) && (minor_main_peak < const_MINOR_MAIN) && (minor_suspect_score < const_SUSPECT_Q)
  reasons:
  - "main={coercion_main_peak:.2f}"
  - "sec={sec_peak:.2f}"
  - "offset=sub:{sub_cnt},rest:{rest_topk:.2f}"
  - "final={coercion_final_score:.2f}"
  - "share={qe_share_max:.2f}"
  - "rating=max({rating.questionable:.2f},{rating.explicit:.2f})"
  stop: true
- id: C-ORG-QUES-STRICT-002
  severity: orange
  priority: 84
  when: is_qplus && qe_share_low && (coercion_final_score >= const_COERCION_FORCE_ORG) && (minor_main_peak < const_MINOR_MAIN) && (minor_suspect_score < const_SUSPECT_Q)
  reasons:
  - "final={coercion_final_score:.2f}"
  - "share={qe_share_max:.2f}"
  - "rating=max({rating.questionable:.2f},{rating.explicit:.2f})"
  stop: true
# 旧 C-RED-001 は v2.1 で無効化（合算＋RED判定を撤廃）
# - id: C-RED-001
#   severity: red
#   priority: 100
#   when: sexual_intensity >= 0.5 && coercion_score >= 1.0
#   reasons:
#   - sexual={sexual_intensity:.2f}
#   - coercion={coercion_score:.2f}
#   stop: true
# 旧 A-RED-001 / A-YEL-001 は v2.1 で無効化（Minor 合算スコア撤廃）
# - id: A-RED-001
#   severity: red
#   priority: 90
#   when: (minor_peak_conf >= 0.3 || minor_body_score >= 0.7 || minor_context_score >= 0.8)
#     && (sexual_intensity >= 0.3 || explicit_score >= 0.3 || exposure_area >= 0.2 || exposure_count >= 2)
#   reasons:
#   - minor_peak={minor_peak_conf:.2f}
#   - minor_body={minor_body_score:.2f}
#   - sex={sexual_intensity:.2f}
#   stop: true
# - id: A-YEL-001
#   severity: yellow
#   priority: 80
#   when: minor_special_score >= 0.35 && (sexual_intensity >= 0.2 || explicit_score >= 0.2 || exposure_area >= 0.1)
#   reasons:
#   - minor_special={minor_special_score:.2f}
#   - sex={sexual_intensity:.2f}

- id: A-RED-EXPL-001
  severity: red
  priority: 97
  when: (minor_main_peak >= const_MINOR_MAIN) && rating_is_explicit
  reasons:
  - "minor_main={minor_main_peak:.2f}"
  - "rating=explicit({rating.explicit:.2f})"
  stop: true
- id: A-ORG-QUES-001
  severity: orange
  priority: 96
  when: (minor_main_peak >= const_MINOR_MAIN) && rating_is_questionable
  reasons:
  - "minor_main={minor_main_peak:.2f}"
  - "rating=questionable({rating.questionable:.2f})"
  stop: true
- id: A-RED-SIT-H-QPLUS-001
  severity: red
  priority: 95
  when: (minor_sit_high_peak >= const_MINOR_MAIN) && rating_is_qplus
  reasons:
  - "minor_sit_high={minor_sit_high_peak:.2f}"
  - "rating=q_plus(exp={rating.explicit:.2f},q={rating.questionable:.2f})"
  stop: true
- id: A-RED-EXPL-SIT-O-001
  severity: red
  priority: 94
  when: minor_sit_enabled && (minor_sit_other_peak >= const_MINOR_MAIN) && rating_is_explicit
  reasons:
  - "minor_sit_other={minor_sit_other_peak:.2f}"
  - "rating=explicit({rating.explicit:.2f})"
  stop: true
- id: A-ORG-QUES-SIT-O-001
  severity: orange
  priority: 93
  when: minor_sit_enabled && (minor_sit_other_peak >= const_MINOR_MAIN) && rating_is_questionable
  reasons:
  - "minor_sit_other={minor_sit_other_peak:.2f}"
  - "rating=questionable({rating.questionable:.2f})"
  stop: true
- id: A-ORG-EXPL-SUS-001
  severity: orange
  priority: 92
  when: minor_sit_enabled && (minor_suspect_seed >= 0.35) && (minor_suspect_score >= const_SUSPECT_E) && rating_is_explicit
  reasons:
  - "minor_suspect={minor_suspect_score:.2f}"
  - "seed={minor_suspect_seed:.2f}"
  - "rating=explicit({rating.explicit:.2f})"
  stop: true
- id: A-YEL-QUES-SUS-001
  severity: yellow
  priority: 91
  when: minor_sit_enabled && (minor_suspect_seed >= 0.35) && (minor_suspect_score >= const_SUSPECT_Q) && rating_is_questionable
  reasons:
  - "minor_suspect={minor_suspect_score:.2f}"
  - "seed={minor_suspect_seed:.2f}"
  - "rating=questionable({rating.questionable:.2f})"
  stop: true
- id: B-RED-NSFW-EXPL-001
  severity: red
  priority: 76
  when: (!channel.is_nsfw) && is_e && !qe_share_low
  reasons:
  - "explicit={rating.explicit:.2f}"
  - "share={qe_share_max:.2f}"
  stop: true
- id: B-ORG-NSFW-QUES-STRICT-001
  severity: orange
  priority: 75
  when: (!channel.is_nsfw) && !qe_share_low && is_q && exposure_prominent && (sexual_main >= const_SEXUAL_MAIN_STRONG) && is_explicit_exposed && !is_low_margin
  reasons:
  - "explicit={rating.explicit:.2f}"
  - "q={rating.questionable:.2f}"
  - "exposure={exposure_area:.2f}"
  - "sexual_main={sexual_main:.2f}"
  - "explicit_exposed={is_explicit_exposed}"
  - "qe_margin={qe_margin:.3f}"
  - "share={qe_share_max:.2f}"
  stop: true
# 旧 B-RED-NSFW-001 / B-ORG-001 は v2.1 で無効化（ExplicitのみをREDとし、Q/Sは基本GREEN）
# - id: B-RED-NSFW-001
#   severity: red
#   priority: 70
#   when: (!channel.is_nsfw) && (explicit_score >= 0.5 || sexual_intensity >= 0.8 || exposure_area >= 0.2)
#   reasons:
#   - explicit={explicit_score:.2f}
#   - sexual={sexual_intensity:.2f}
#   - exposure={exposure_area:.2f}
#   stop: true
# - id: B-ORG-001
#   severity: orange
#   priority: 60
#   when: (!channel.is_nsfw) && (sexual_intensity >= 0.4 || nsfw_rating_max >= 0.5 || exposure_area >= 0.15)
#   reasons:
#   - sexual={sexual_intensity:.2f}
#   - rating={nsfw_rating_max:.2f}
#   - exposure={exposure_area:.2f}
- id: D-RED-SEX-GORE-STRICT-001
  severity: red
  priority: 78
  when: gore_heavy_gate && !qe_share_low && (gore_final_score >= gore_red_threshold) && (is_e || sexual_main >= const_SEXUAL_MAIN_STRONG)
  reasons:
  - "gate(main={gore_main_peak:.2f},dense={gore_density_cnt:.0f},int=max({injury_topk:.2f},{blood_topk:.2f}))"
  - "final={gore_final_score:.2f} (base={gore_base_score:.2f}+offset={gore_offset:.2f})"
  - "sexual_main={sexual_main:.2f}"
  - "explicit={rating.explicit:.2f}"
  - "share={qe_share_max:.2f}"
  stop: true
- id: D-ORG-GORE-STRICT-001
  severity: orange
  priority: 67
  when: gore_heavy_gate && (gore_final_score >= gore_org_threshold)
  reasons:
  - "gate(main={gore_main_peak:.2f},dense={gore_density_cnt:.0f},int=max({injury_topk:.2f},{blood_topk:.2f}))"
  - "final={gore_final_score:.2f} (base={gore_base_score:.2f}+offset={gore_offset:.2f})"
  stop: true
# 旧 D-RED-001 / D-ORG-001 は v2.1 で無効化（重ゴアANDゲートへ移行）
# - id: D-RED-001
#   severity: red
#   priority: 55
#   when: (gore_peak_conf >= 0.2 || gore_intensity >= 2.5) && sexual_intensity >= 0.3
#   reasons:
#   - gore={gore_intensity:.2f}
#   - sexual={sexual_intensity:.2f}
#   stop: true
# - id: D-ORG-001
#   severity: orange
#   priority: 50
#   when: gore_peak_conf >= 0.2 || gore_density >= 3 || gore_intensity >= 2.0
#   reasons:
#   - gore={gore_intensity:.2f}
#   - density={gore_density}
- id: E-RED-QPLUS-BEST-001
  severity: red
  priority: 79
  when: is_qplus && !qe_share_low && (bestiality_peak >= const_BESTIALITY)
  reasons:
  - "bestiality={bestiality_peak:.2f}"
  - "rating=q_plus(exp={rating.explicit:.2f},q={rating.questionable:.2f})"
  - "share={qe_share_max:.2f}"
  stop: true
- id: E-ORG-QPLUS-SUS-001
  severity: orange
  priority: 78
  when: is_qplus && !qe_share_low && (animal_presence >= const_ANIMAL_PRES) && ((sexual_main >= const_SEXUAL_MAIN_STRONG) || is_explicit_exposed) && !is_low_margin
  reasons:
  - "bestiality={bestiality_peak:.2f}"
  - "presence={animal_presence:.2f}"
  - "sexual_main={sexual_main:.2f}"
  - "explicit_exposed={is_explicit_exposed}"
  - "rating=q_plus(exp={rating.explicit:.2f},q={rating.questionable:.2f})"
  - "share={qe_share_max:.2f}"
  stop: true
- id: E-YEL-QPLUS-PRES-001
  severity: yellow
  priority: 77
  when: is_qplus && (animal_presence >= const_ANIMAL_PRES)
  reasons:
  - "presence={animal_presence:.2f}"
  - "rating=q_plus(exp={rating.explicit:.2f},q={rating.questionable:.2f})"
  stop: true
# 旧 E-RED-001 / E-YEL-001 は v2.1 で無効化（名指しRED / 存在YEL / 疑いORGへ置換）
# - id: E-RED-001
#   severity: red
#   priority: 45
#   when: max('bestiality_direct') >= 0.2
#   reasons:
#   - bestiality={max('bestiality_direct'):.2f}
#   stop: true
# - id: E-YEL-001
#   severity: yellow
#   priority: 40
#   when: animal_presence >= 0.3 && sexual_intensity >= 0.3
#   reasons:
#   - animals={animal_presence:.2f}
#   - sexual={sexual_intensity:.2f}
